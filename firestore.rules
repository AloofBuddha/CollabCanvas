rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // User profiles
    // - All authenticated users can read any user profile (for presence/cursors)
    // - Users can only write their own profile
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Shapes collection
    // - All authenticated users can read all shapes (real-time collaboration)
    // - All authenticated users can create shapes
    // - All authenticated users can update/delete shapes (for collaborative editing)
    // 
    // Note: In a production app with multiple canvases, you'd want to scope this
    // to specific canvas documents and check permissions per canvas
    match /shapes/{shapeId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null;
    }
  }
}

